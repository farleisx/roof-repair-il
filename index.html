<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>AI-Powered Web Builder</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      background: #f9f9f9;
    }
    textarea, input {
      width: 100%;
      padding: 10px;
      font-size: 1rem;
      margin-bottom: 10px;
      box-sizing: border-box;
    }
    iframe {
      width: 100%;
      height: 400px;
      border: 1px solid #ccc;
      margin-top: 15px;
    }
    button {
      padding: 10px 15px;
      font-size: 1rem;
      cursor: pointer;
      background: #007bff;
      color: white;
      border: none;
      border-radius: 6px;
    }
    button:disabled {
      background: #aaa;
      cursor: not-allowed;
    }
    label {
      font-weight: bold;
      display: block;
      margin-top: 10px;
      margin-bottom: 5px;
    }
  </style>
</head>
<body>

  <h1>AI-Powered Website Builder</h1>

  <label for="prompt">Describe your website:</label>
  <textarea id="prompt" rows="4" placeholder="e.g. A landing page with a dark background and a big red button"></textarea>

  <button id="generateBtn" disabled>Generating...</button>

  <h2>Live Preview:</h2>
  <iframe id="preview" sandbox="allow-scripts"></iframe>

<script>
  const promptInput = document.getElementById('prompt');
  const preview = document.getElementById('preview');
  const generateBtn = document.getElementById('generateBtn');

  let timeoutId = null;

  // Enable button only when prompt is not empty
  promptInput.addEventListener('input', () => {
    generateBtn.disabled = !promptInput.value.trim();
    debounceGenerate();
  });

  generateBtn.addEventListener('click', generate);

  // Debounce user typing (auto update after stop typing 1.5s)
  function debounceGenerate() {
    clearTimeout(timeoutId);
    if (!promptInput.value.trim()) return;
    generateBtn.textContent = 'Generating...';
    generateBtn.disabled = true;
    timeoutId = setTimeout(() => {
      generate();
    }, 1500);
  }

  async function generate() {
    const prompt = promptInput.value.trim();
    if (!prompt) return;

    generateBtn.disabled = true;
    generateBtn.textContent = 'Generating...';

    try {
      // Call your backend proxy endpoint here
      const response = await fetch('https://687dd834-e975-444d-b3e8-58005f51b520-00-35dllz6mcvi7.sisko.replit.dev/', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ prompt })
      });

      if (!response.ok) throw new Error('Network error');

      const data = await response.json();

      if (data.html) {
        preview.srcdoc = data.html;
      } else {
        preview.srcdoc = `<pre>Error: No HTML received</pre>`;
      }
    } catch (e) {
      preview.srcdoc = `<pre>Error: ${e.message}</pre>`;
    } finally {
      generateBtn.textContent = 'Generate';
      generateBtn.disabled = false;
    }
  }
</script>

</body>
</html>

<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Barber Booking</title>
  <link href="https://fonts.googleapis.com/css2?family=Rubik:wght@400;500;700&display=swap" rel="stylesheet">
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: 'Rubik', sans-serif; line-height: 1.6; scroll-behavior: smooth; }
    a { text-decoration: none; color: inherit; }
    img { max-width: 100%; display: block; border-radius: 8px; }
    section { padding: 60px 20px; }
    h1, h2, h3, h4 { color: inherit; }

    .top-bar { display: flex; justify-content: space-between; align-items: center; padding: 15px 25px; border-bottom: 2px solid #ccc; }
    .top-bar button { border: none; padding: 12px 25px; font-size: 1rem; border-radius: 6px; cursor: pointer; transition: background 0.3s ease; }
    .top-bar button:hover { transform: scale(1.05); }
    .top-bar span { font-size: 1rem; font-weight: 500; }

    .hero { position: relative; height: 90vh; display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center; }
    .hero-content { position: relative; z-index: 2; max-width: 800px; margin: 0 auto; padding: 0 20px; }
    .hero h1 { font-size: 3rem; margin-bottom: 20px; line-height: 1.2; }
    .hero h2 { font-size: 1.5rem; margin-bottom: 30px; }
    .hero button { padding: 15px 35px; border: none; border-radius: 50px; cursor: pointer; transition: transform 0.3s ease, box-shadow 0.3s ease; }
    .hero button:hover { transform: scale(1.05); }

    .services { max-width: 1200px; margin: 0 auto; display: flex; flex-wrap: wrap; justify-content: space-around; gap: 30px; }
    .service-card { border-radius: 15px; padding: 25px; flex: 1 1 250px; max-width: 300px; transition: transform 0.3s ease, box-shadow 0.3s ease; text-align: center; }
    .service-card:hover { transform: translateY(-8px); }
    .service-card h4 { margin: 15px 0 10px; }
    .service-card p { font-size: 0.95rem; }

    .contact-form-container { max-width: 600px; margin: 0 auto; padding: 40px 30px; border-radius: 15px; }
    .contact-form-container h3 { text-align: center; margin-bottom: 25px; }
    .contact-form-container form { display: flex; flex-direction: column; gap: 15px; }
    .contact-form-container input, .contact-form-container select { padding: 15px; border-radius: 8px; border: 1px solid #ddd; font-size: 1rem; }
    .contact-form-container button { padding: 15px; border: none; border-radius: 50px; font-size: 1.1rem; cursor: pointer; transition: transform 0.3s ease, box-shadow 0.3s ease; }
    .contact-form-container button:hover { transform: scale(1.05); }
    #status { text-align:center; margin-top:15px; font-weight:bold; }

    .gallery { max-width: 1200px; margin: 0 auto; display: grid; grid-template-columns: repeat(4, 1fr); gap: 25px; }
    .gallery img { width: 100%; border-radius: 15px; opacity: 0; transform: translateY(20px); transition: all 0.6s ease; }
    .gallery img.visible { opacity: 1; transform: translateY(0); }

    footer { text-align: center; padding: 25px 10px; font-size: 0.9rem; }

    @media(max-width:1024px){ .gallery { grid-template-columns: repeat(2, 1fr); } }
    @media(max-width:768px){ 
      .hero h1 { font-size: 2.2rem; } 
      .hero h2 { font-size: 1.2rem; } 
      .top-bar { flex-direction: column; gap: 10px; text-align: center; } 
      .gallery { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>

  <!-- Top Bar -->
  <div class="top-bar">
    <button>Call</button>
    <span>ספרות גברים</span>
  </div>

  <!-- Hero Section -->
  <section class="hero">
    <div class="hero-content">
      <h1>ברוך הבא למספרה</h1>
      <h2>קבע תור במהירות ובקלות</h2>
      <button onclick="document.getElementById('leadForm').scrollIntoView({ behavior: 'smooth' });">קבע תור</button>
    </div>
  </section>

  <!-- Services Section -->
  <section>
    <h3 style="text-align:center; margin-bottom:50px;">השירותים שלנו</h3>
    <div class="services">
      <div class="service-card">
        <h4>תספורת</h4>
        <p>תספורת מקצועית לגברים</p>
      </div>
      <div class="service-card">
        <h4>זקן</h4>
        <p>עיצוב וגילוח זקן</p>
      </div>
      <div class="service-card">
        <h4>חבילה מלאה</h4>
        <p>תספורת + זקן במחיר מיוחד</p>
      </div>
    </div>
  </section>

  <!-- Booking Form -->
  <section>
    <div class="contact-form-container">
      <h3>קביעת תור</h3>
      <form id="leadForm">
        <input type="text" name="name" placeholder="שם מלא" required>
        <input type="tel" name="phone" placeholder="טלפון" required>
        <select name="service" required>
          <option value="">בחר שירות</option>
          <option value="תספורת">תספורת</option>
          <option value="זקן">זקן</option>
          <option value="חבילה מלאה">חבילה מלאה</option>
        </select>
        <input type="date" name="date" required>
        <input type="time" name="time" required>
        <button type="submit">קבע תור</button>
      </form>
      <p id="status"></p>
    </div>
  </section>

  <!-- Gallery Section -->
  <section>
    <h3 style="text-align:center; margin-bottom:50px;">גלריה</h3>
    <div class="gallery">
      <img alt="Image 1">
      <img alt="Image 2">
      <img alt="Image 3">
      <img alt="Image 4">
    </div>
  </section>

  <!-- Footer -->
  <footer>
    © 2025 Barber Shop
  </footer>

  <!-- JS -->
  <script>
    // Gallery fade-in
    const galleryImages = document.querySelectorAll('.gallery img');
    const observer = new IntersectionObserver((entries, obs) => {
      entries.forEach(entry => {
        if(entry.isIntersecting){
          entry.target.classList.add('visible');
          obs.unobserve(entry.target);
        }
      });
    }, {threshold:0.5});
    galleryImages.forEach(img => observer.observe(img));

    // Booking logic
    const leadForm = document.getElementById("leadForm");
    const dateInput = leadForm.querySelector('input[name="date"]');
    const timeInput = leadForm.querySelector('input[name="time"]');
    const statusEl = document.getElementById("status");

    let bookedAppointments = [];

    async function fetchAppointments() {
      try {
        const response = await fetch("https://script.google.com/macros/s/AKfycbz8mLLU3TYi8Ma8A_coDFbH1TUuUOIl5wPN3iec001zWylxeiFcWZnChvpJeHegKG9qfg/exec");
        bookedAppointments = await response.json();
      } catch (err) {
        console.error("Failed to fetch appointments:", err);
      }
    }

    function isTimeValid(selectedDate, selectedTime) {
      const now = new Date();
      const [hours, minutes] = selectedTime.split(":").map(Number);
      const selected = new Date(selectedDate + "T" + selectedTime + ":00");
      if (selected - now < 60*60*1000) return false; // less than 1 hour
      for (const appt of bookedAppointments) {
        if (appt.date === selectedDate && appt.time === selectedTime) return false;
      }
      return true;
    }

    timeInput.addEventListener("change", () => {
      if (!isTimeValid(dateInput.value, timeInput.value)) {
        statusEl.innerText = "⚠️ הזמן הזה אינו זמין, בחר שעה אחרת.";
        statusEl.style.color = "red";
      } else {
        statusEl.innerText = "";
      }
    });

    leadForm.addEventListener("submit", async function(e) {
      e.preventDefault();
      const formData = new FormData(leadForm);
      const params = new URLSearchParams(formData);

      if (!isTimeValid(dateInput.value, timeInput.value)) {
        statusEl.innerText = "⚠️ הזמן הזה אינו זמין, בחר שעה אחרת.";
        statusEl.style.color = "red";
        return;
      }

      try {
        const response = await fetch(
          "https://script.google.com/macros/s/AKfycbz8mLLU3TYi8Ma8A_coDFbH1TUuUOIl5wPN3iec001zWylxeiFcWZnChvpJeHegKG9qfg/exec",
          { method: "POST", body: params }
        );
        const result = await response.text();

        if (result.toLowerCase() === "success") {
          statusEl.innerText = "✅ התור נקבע בהצלחה!";
          statusEl.style.color = "green";
          leadForm.reset();
          fetchAppointments();
        } else if (result.toLowerCase() === "unavailable") {
          statusEl.innerText = "⚠️ השעה הזאת כבר תפוסה.";
          statusEl.style.color = "red";
        } else if (result.toLowerCase() === "too_soon") {
          statusEl.innerText = "⚠️ השעה חייבת להיות לפחות שעה מהזמן הנוכחי.";
          statusEl.style.color = "red";
        } else {
          statusEl.innerText = "❌ שגיאה: " + result;
          statusEl.style.color = "red";
        }
      } catch(err) {
        statusEl.innerText = "❌ בקשה נכשלה";
        statusEl.style.color = "red";
      }
    });

    // Initial fetch & auto-refresh every 2 min
    fetchAppointments();
    setInterval(fetchAppointments, 120000);

  </script>

</body>
</html>
